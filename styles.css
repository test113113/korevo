/**
 * 준비 중 페이지 알림
 */
function showUnderConstruction() {
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>🚧 페이지 준비 중</h3>
                <button class="close-btn" onclick="closeConstructionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; font-size: 4rem; margin-bottom: 1rem;">🏗️</div>
                <p>해당 페이지는 현재 준비 중입니다.</p>
                <p>빠른 시일 내에 서비스를 제공하겠습니다.</p>
                <div style="margin-top: 2rem; text-align: center;">
                    <button onclick="closeConstructionModal()" class="btn btn-primary">확인</button>
                </div>
            </div>
        </div>
    `;

    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
}

/**
 * 준비 중 모달 닫기
 */
function closeConstructionModal() {
    const modal = document.querySelector('.modal');
    if (modal) {
        modal.classList.remove('active');
        setTimeout(() => {
            modal.remove();
            document.body.style.overflow = '';
        }, 300);
    }
}

// ===== LANGUAGE SELECTOR =====

/**
 * 언어 선택기 초기화
 */
function initLanguageSelector() {
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // 모든 언어 버튼에서 active 클래스 제거
            document.querySelectorAll('.lang-btn').forEach(b => {
                b.classList.remove('active');
            });
            
            // 클릭된 버튼에 active 클래스 추가
            this.classList.add('active');
            
            // 언어 변경 피드백
            const langText = this.textContent.trim();
            showAppleNotification(`언어가 ${langText}로 변경되었습니다.`, 'info');
            
            console.log('언어 변경:', langText);
        });
    });
}

// ===== SCROLL EFFECTS =====

/**
 * 스크롤 효과 초기화
 */
function initScrollEffects() {
    let lastScrollTop = 0;
    const header = document.querySelector('.header');
    
    window.addEventListener('scroll', function() {
        if (isScrolling) return;
        
        isScrolling = true;
        requestAnimationFrame(() => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            // 헤더 스크롤 효과
            if (header) {
                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    // 스크롤 다운
                    header.style.transform = 'translateY(-100%)';
                } else {
                    // 스크롤 업
                    header.style.transform = 'translateY(0)';
                }
                
                // 스크롤에 따른 배경 투명도 조절
                const opacity = Math.min(scrollTop / 100, 0.95);
                header.style.background = `rgba(255, 255, 255, ${0.8 + opacity * 0.15})`;
            }
            
            lastScrollTop = scrollTop;
            isScrolling = false;
        });
    });
    
    // 스크롤 애니메이션 관찰자
    initScrollAnimations();
}

/**
 * 스크롤 애니메이션 초기화
 */
function initScrollAnimations() {
    const animationObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-fade-in');
            }
        });
    }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    });

    // 애니메이션 대상 요소들 관찰
    document.querySelectorAll('.feature-card, .cta-section, .page-header').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        animationObserver.observe(el);
    });
}

// ===== NOTIFICATION SYSTEM =====

/**
 * 알림 시스템 초기화
 */
function initNotificationSystem() {
    // 기존 알림 제거 함수
    window.removeExistingNotifications = function() {
        document.querySelectorAll('.apple-notification').forEach(notification => {
            notification.remove();
        });
    };
}

/**
 * 애플 스타일 알림 표시
 */
function showAppleNotification(message, type = 'info', duration = 4000) {
    // 기존 알림 제거
    const existingNotification = document.querySelector('.apple-notification');
    if (existingNotification) {
        existingNotification.remove();
    }

    const notification = document.createElement('div');
    notification.className = `apple-notification apple-notification-${type}`;
    
    const iconMap = {
        'success': '✓',
        'error': '✕',
        'warning': '⚠',
        'info': 'ℹ'
    };
    
    const icon = iconMap[type] || 'ℹ';
    
    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 1.2rem; font-weight: 600;">${icon}</span>
            <span style="flex: 1;">${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" 
                    style="background: none; border: none; cursor: pointer; opacity: 0.6; font-size: 1.1rem;">×</button>
        </div>
    `;

    document.body.appendChild(notification);

    // 애니메이션 표시
    setTimeout(() => notification.classList.add('show'), 10);

    // 자동 제거
    if (duration > 0) {
        setTimeout(() => {
            if (notification.parentElement) {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }
        }, duration);
    }
}

// ===== UTILITY FUNCTIONS =====

/**
 * 페이지 이름을 표시명으로 변환
 */
function getDisplayName(pageName) {
    const displayNames = {
        'vision': '비전 & 미션',
        'history': '연혁',
        'team': '팀 소개',
        'brand-philosophy': '브랜드 철학',
        'traditional-craft': '전통 기법 계승',
        'business-model': '사업 모델',
        'innovation-strategy': '혁신 전략',
        'sustainability': '지속가능경영',
        'dining-set': '식기 컬렉션',
        'health-products': '건강 케어 제품',
        'gift-sets': '프리미엄 선물세트',
        'custom-craft': '맞춤 제작 서비스',
        'erp-solution': '제조업 ERP 솔루션',
        'iot-platform': 'IoT 품질관리 플랫폼',
        'ecommerce-system': '전통공예 전자상거래',
        'consulting': '디지털 전환 컨설팅',
        'current-projects': '진행중 과제',
        'completed-projects': '완료 과제',
        'research-outcomes': '연구 성과',
        'collaboration': '산학연 협력'
    };
    return displayNames[pageName] || pageName;
}

/**
 * 디바운스 함수
 */
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

/**
 * 스로틀 함수
 */
function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// ===== FORM HANDLING =====

/**
 * 폼 유효성 검사
 */
function validateForm(form) {
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.style.borderColor = 'var(--apple-red)';
            isValid = false;
        } else {
            field.style.borderColor = 'var(--separator)';
    /**
 * KOREVO - Apple Design System JavaScript
 * 통합 스크립트 파일
 */

// ===== GLOBAL VARIABLES =====
let isMenuOpen = false;
let isScrolling = false;

// ===== MOBILE MENU FUNCTIONALITY =====

/**
 * 개선된 모바일 메뉴 토글 함수
 */
function toggleMenu() {
    const navMenu = document.querySelector('.nav-menu');
    const menuToggle = document.querySelector('.menu-toggle');
    const body = document.body;
    
    if (!navMenu || !menuToggle) {
        console.warn('Navigation elements not found');
        return;
    }
    
    isMenuOpen = !isMenuOpen;
    
    if (isMenuOpen) {
        // 메뉴 열기
        navMenu.classList.add('active');
        menuToggle.classList.add('active');
        body.classList.add('menu-open');
        menuToggle.setAttribute('aria-expanded', 'true');
        
        // 오버레이 생성
        createMobileOverlay();
        
        // 첫 번째 메뉴 항목에 포커스
        const firstNavLink = navMenu.querySelector('.nav-link');
        if (firstNavLink) {
            setTimeout(() => firstNavLink.focus(), 100);
        }
        
        console.log('모바일 메뉴 열림');
    } else {
        // 메뉴 닫기
        closeMobileMenu();
    }
}

/**
 * 모바일 메뉴 닫기
 */
function closeMobileMenu() {
    const navMenu = document.querySelector('.nav-menu');
    const menuToggle = document.querySelector('.menu-toggle');
    const body = document.body;
    const overlay = document.querySelector('.mobile-menu-overlay');
    
    if (navMenu) navMenu.classList.remove('active');
    if (menuToggle) {
        menuToggle.classList.remove('active');
        menuToggle.setAttribute('aria-expanded', 'false');
    }
    body.classList.remove('menu-open');
    
    if (overlay) {
        overlay.classList.remove('active');
        setTimeout(() => overlay.remove(), 300);
    }
    
    // 모든 드롭다운 닫기
    document.querySelectorAll('.dropdown, .mega-dropdown').forEach(dropdown => {
        dropdown.classList.remove('active');
    });
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('expanded');
    });
    
    isMenuOpen = false;
    console.log('모바일 메뉴 닫힘');
}

/**
 * 모바일 오버레이 생성
 */
function createMobileOverlay() {
    // 기존 오버레이 제거
    const existingOverlay = document.querySelector('.mobile-menu-overlay');
    if (existingOverlay) existingOverlay.remove();
    
    const overlay = document.createElement('div');
    overlay.className = 'mobile-menu-overlay';
    
    // 오버레이 클릭 시 메뉴 닫기
    overlay.addEventListener('click', closeMobileMenu);
    
    document.body.appendChild(overlay);
    
    // 애니메이션을 위해 약간 지연
    setTimeout(() => overlay.classList.add('active'), 10);
}

/**
 * 모바일 드롭다운 토글
 */
function toggleMobileDropdown(event, element) {
    // 모바일에서만 작동
    if (window.innerWidth > 768) return;
    
    event.preventDefault();
    event.stopPropagation();
    
    const navItem = element.closest('.nav-item');
    const dropdown = navItem.querySelector('.dropdown, .mega-dropdown');
    
    if (!dropdown) return;
    
    // 다른 드롭다운 닫기
    document.querySelectorAll('.nav-item').forEach(item => {
        if (item !== navItem) {
            item.classList.remove('expanded');
            const otherDropdown = item.querySelector('.dropdown, .mega-dropdown');
            if (otherDropdown) otherDropdown.classList.remove('active');
        }
    });
    
    // 현재 드롭다운 토글
    const isExpanded = navItem.classList.contains('expanded');
    navItem.classList.toggle('expanded');
    dropdown.classList.toggle('active');
    
    // ARIA 속성 업데이트
    element.setAttribute('aria-expanded', (!isExpanded).toString());
    
    console.log(`드롭다운 ${isExpanded ? '닫힘' : '열림'}:`, element.textContent.trim());
}

// ===== EVENT LISTENERS =====

/**
 * ESC 키 이벤트
 */
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && isMenuOpen) {
        closeMobileMenu();
    }
});

/**
 * 창 크기 변경 시 메뉴 닫기
 */
let resizeTimeout;
window.addEventListener('resize', function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(function() {
        if (window.innerWidth > 768 && isMenuOpen) {
            closeMobileMenu();
        }
    }, 250);
});

/**
 * DOM 로드 완료 시 초기화
 */
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

/**
 * 앱 초기화
 */
function initializeApp() {
    console.log('KOREVO 웹사이트 초기화 시작');
    
    // 모바일 드롭다운 이벤트 리스너 추가
    initMobileDropdowns();
    
    // 비디오 초기화
    initializeVideo();
    
    // 접근성 기능 초기화
    initAccessibility();
    
    // 스크롤 효과 초기화
    initScrollEffects();
    
    // 언어 선택기 초기화
    initLanguageSelector();
    
    // 알림 시스템 초기화
    initNotificationSystem();
    
    console.log('KOREVO 웹사이트 초기화 완료');
}

/**
 * 모바일 드롭다운 초기화
 */
function initMobileDropdowns() {
    document.querySelectorAll('.nav-item').forEach(item => {
        const link = item.querySelector('.nav-link');
        const hasDropdown = item.querySelector('.dropdown, .mega-dropdown');
        
        if (hasDropdown && link) {
            // 모바일에서 클릭 이벤트 추가
            link.addEventListener('click', function(e) {
                if (window.innerWidth <= 768) {
                    toggleMobileDropdown(e, this);
                }
            });
            
            // 키보드 지원
            link.addEventListener('keydown', function(e) {
                if (window.innerWidth <= 768 && (e.key === 'Enter' || e.key === ' ')) {
                    e.preventDefault();
                    toggleMobileDropdown(e, this);
                }
            });
        }
    });
}

/**
 * 접근성 기능 초기화
 */
function initAccessibility() {
    const menuToggle = document.querySelector('.menu-toggle');
    const mobileMenu = document.querySelector('.nav-menu');
    
    if (menuToggle) {
        menuToggle.setAttribute('aria-expanded', 'false');
        menuToggle.setAttribute('aria-controls', 'navMenu');
        menuToggle.setAttribute('aria-label', '메뉴 토글');
    }
    
    if (mobileMenu) {
        mobileMenu.setAttribute('role', 'navigation');
        mobileMenu.setAttribute('aria-label', '주 메뉴');
        mobileMenu.id = 'navMenu';
    }
    
    // 키보드 네비게이션 지원
    document.addEventListener('keydown', function(e) {
        if (isMenuOpen && e.key === 'Tab') {
            const focusableElements = mobileMenu.querySelectorAll(
                'a, button, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            if (e.shiftKey) {
                // Shift + Tab
                if (document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                }
            } else {
                // Tab
                if (document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        }
    });
}

// ===== VIDEO HANDLING =====

/**
 * 비디오 에러 처리
 */
function handleVideoError(video) {
    console.warn('Video failed to load:', video.currentSrc || video.src);
    video.style.display = 'none';
    video.classList.add('error');
    
    const fallback = document.querySelector('.hero-fallback-image');
    if (fallback) {
        fallback.style.opacity = '0.8';
    }
    
    if (video.error) {
        console.error('Video error details:', {
            code: video.error.code,
            message: video.error.message
        });
    }
}

/**
 * 비디오 로드 성공
 */
function handleVideoLoad(video) {
    console.log('Video can start playing:', video.currentSrc || video.src);
    video.classList.add('loaded');
}

/**
 * 비디오 데이터 로드 완료
 */
function handleVideoLoadedData(video) {
    console.log('Video loaded successfully:', video.currentSrc || video.src);
    
    const playPromise = video.play();
    
    if (playPromise !== undefined) {
        playPromise
            .then(() => {
                console.log('Video playing successfully');
                video.classList.add('loaded');
            })
            .catch(error => {
                console.warn('Video autoplay failed:', error);
                handleVideoError(video);
            });
    }
}

/**
 * 비디오 초기화
 */
function initializeVideo() {
    const video = document.querySelector('.hero-video');
    
    if (!video) return;

    // 모바일 지원 향상
    video.setAttribute('webkit-playsinline', '');
    video.setAttribute('playsinline', '');
    video.muted = true;
    
    // 이벤트 리스너 추가
    video.addEventListener('loadstart', () => console.log('Video loading started'));
    video.addEventListener('canplay', () => handleVideoLoad(video));
    video.addEventListener('loadeddata', () => handleVideoLoadedData(video));
    video.addEventListener('error', () => handleVideoError(video));
    
    // 교차점 관찰자로 뷰포트에 들어올 때 재생
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                video.play().catch(error => {
                    console.warn('Video play failed:', error);
                });
            } else {
                video.pause();
            }
        });
    }, { threshold: 0.1 });
    
    observer.observe(video);
}

// ===== NAVIGATION FUNCTIONS =====

/**
 * 페이지 네비게이션
 */
function navigateToPage(pageName) {
    console.log('페이지 이동:', pageName);
    
    // 모바일 메뉴가 열려있으면 닫기
    if (isMenuOpen) {
        closeMobileMenu();
    }
    
    // 로딩 상태 표시
    showLoadingState();
    
    // 실제 페이지 매핑
    const pageMapping = {
        'vision': 'vision.html',
        'history': 'history.html',
        'team': 'team.html',
        'brand-philosophy': 'brand-philosophy.html',
        'traditional-craft': 'traditional-craft.html',
        'business-model': 'business-model.html',
        'innovation-strategy': 'innovation-strategy.html',
        'sustainability': 'sustainability.html',
        'dining-set': 'dining-set.html',
        'health-products': 'health-care.html',
        'gift-sets': 'gift-sets.html',
        'custom-craft': 'custom-service.html',
        'erp-solution': 'erp-solution.html',
        'iot-platform': 'iot-platform.html',
        'ecommerce-system': 'ecommerce.html',
        'consulting': 'consulting.html',
        'current-projects': 'current-projects.html',
        'completed-projects': 'completed-projects.html',
        'research-outcomes': 'research-outcomes.html',
        'collaboration': 'collaboration.html'
    };
    
    const targetPage = pageMapping[pageName];
    
    if (targetPage) {
        // 실제 페이지로 이동
        setTimeout(() => {
            window.location.href = targetPage;
        }, 500);
    } else {
        // 준비 중 페이지 알림
        setTimeout(() => {
            hideLoadingState();
            showUnderConstruction();
        }, 1000);
    }
}

/**
 * 로딩 상태 표시
 */
function showLoadingState() {
    const existingLoading = document.getElementById('loadingState');
    if (existingLoading) return;
    
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'loadingState';
    loadingDiv.innerHTML = `
        <div style="
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        ">
            <div class="loading-spinner"></div>
            <p style="margin-top: 16px; color: var(--apple-medium-gray); font-size: 16px;">로딩 중...</p>
        </div>
    `;
    document.body.appendChild(loadingDiv);
}

/**
 * 로딩 상태 숨기기
 */
function hideLoadingState() {
    const loadingDiv = document.getElementById('loadingState');
    if (loadingDiv) {
        loadingDiv.style.opacity = '0';
        setTimeout(() => loadingDiv.remove(), 300);
    }
}

/**
 * 준비 중 페이지 알림
 */
function showUnderConstruction() {
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.innerHTML = `
